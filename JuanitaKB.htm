<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juanita Keyboard</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        #todo {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        #L1 {
            width: 100%;
            height: 15%;
            background-color: #000;
            color: #FFF;
            font-size: 5em;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L2 {
            width: 100%;
            height: 51%;
            font-size: 4em;
            display: flex;
        }

        #L21 {
            width: 44.4%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #L211, #L212, #L213 {
            width: 100%;
            display: flex;
        }

        #L211 {
            height: 33.3%;
        }

        #L212 {
            height: 33.3%;
        }

        #L213 {
            height: 33.4%;
        }

        .letra {
            width: 25%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L2111, #L2113, #L2122, #L2124, #L2131, #L2133 {
            background-color: #BBF;
        }

        #L2112, #L2114, #L2121, #L2123, #L2132, #L2134 {
            background-color: #BFB;
        }

        #L22 {
            width: 11.1%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #L221 {
            width: 100%;
            height: 34.0%;
            background-color: #FFF;
            font-size: 0.3em;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L222 {
            width: 100%;
            height: 33.0%;
            background-color: #EEE;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L223 {
            width: 100%;
            height: 33.0%;
            background-color: #FFF;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L23 {
            width: 44.4%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #L231, #L232, #L233 {
            width: 100%;
            display: flex;
        }

        #L231 {
            height: 34.0%;
        }

        #L232, #L233 {
            height: 33.0%;
        }

        #L2311, #L2313, #L2322, #L2324, #L2331, #L2333 {
            background-color: #BBF;
        }

        #L2312, #L2314, #L2321, #L2323, #L2332, #L2334 {
            background-color: #BFB;
        }

        #L3 {
            width: 100%;
            height: 15%;
            font-size: 4em;
            display: flex;
        }

        #L31 {
            width: 22.2%;
            height: 100%;
            background-color: #3F3;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L32, #L33, #L34, #L35, #L36 {
            width: 11.1%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L32, #L34, #L36 {
            background-color: #F88;
        }

        #L33, #L35 {
            background-color: #FF8;
        }

        #L37 {
            width: 22.2%;
            height: 100%;
            background-color: #F33;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L4 {
            width: 100%;
            height: 15%;
            font-size: 3em;
            display: flex;
        }

        #L41 {
            width: 20%;
            height: 100%;
            background-color: #DDD;
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L42 {
            width: 40%;
            height: 100%;
            border: 1px solid #000;
            display: flex;
            flex-direction: column;
        }

        #L421 {
            width: 100%;
            height: 30%;
            background-color: #DDD;
            font-size: 0.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #L422 {
            width: 100%;
            height: 70%;
            display: flex;
        }

        #L4221, #L4222, #L4223 {
            width: 33.3%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #L43 {
            width: 38%;
            height: 100%;
            border: 1px solid #000;
            display: flex;
            flex-direction: column;
        }

        #L431 {
            width: 100%;
            height: 30%;
            background-color: #DDD;
            font-size: 0.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #L432 {
            width: 100%;
            height: 70%;
            display: flex;
        }

        #L4321, #L4322 {
            width: 50%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .activo {
            border: 5px solid #000 !important;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
<div id="todo">
    <div id="L1"><i>Toca la pantalla para escribir</i></div>
    
    <div id="L2">
        <div id="L21">
            <div id="L211">
                <div id="L2111" class="letra">b</div>
                <div id="L2112" class="letra">c</div>
                <div id="L2113" class="letra">ch</div>
                <div id="L2114" class="letra">d</div>
            </div>
            <div id="L212">
                <div id="L2121" class="letra">f</div>
                <div id="L2122" class="letra">g</div>
                <div id="L2123" class="letra">h</div>
                <div id="L2124" class="letra">j</div>
            </div>
            <div id="L213">
                <div id="L2131" class="letra">k</div>
                <div id="L2132" class="letra">l</div>
                <div id="L2133" class="letra">ll</div>
                <div id="L2134" class="letra">m</div>
            </div>
        </div>
        
        <div id="L22">
            <div id="L221">ESPACIO</div>
            <div id="L222">?</div>
            <div id="L223">,</div>
        </div>
        
        <div id="L23">
            <div id="L231">
                <div id="L2311" class="letra">n</div>
                <div id="L2312" class="letra">ñ</div>
                <div id="L2313" class="letra">p</div>
                <div id="L2314" class="letra">qu</div>
            </div>
            <div id="L232">
                <div id="L2321" class="letra">r</div>
                <div id="L2322" class="letra">s</div>
                <div id="L2323" class="letra">t</div>
                <div id="L2324" class="letra">v</div>
            </div>
            <div id="L233">
                <div id="L2331" class="letra">w</div>
                <div id="L2332" class="letra">x</div>
                <div id="L2333" class="letra">y</div>
                <div id="L2334" class="letra">z</div>
            </div>
        </div>
    </div>
    
    <div id="L3">
        <div id="L31">Sí</div>
        <div id="L32">a</div>
        <div id="L33">e</div>
        <div id="L34">i</div>
        <div id="L35">o</div>
        <div id="L36">u</div>
        <div id="L37">No</div>
    </div>

    <div id="L4">
        <div id="L41">Núm./Acentos</div>
        <div id="L42">
            <div id="L421">Borrar:</div>
            <div id="L422">
                <div id="L4221">letra,</div>
                <div id="L4222">palabra,</div>
                <div id="L4223">todo.</div>
            </div>
        </div>
        <div id="L43">
            <div id="L431">Frase hecha:</div>
            <div id="L432">
                <div id="L4321">anterior,</div>
                <div id="L4322">siguiente.</div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
// Variables globales
let textoCompleto = '';
let numeros = 0;
let ListaIndex = 0;
let elem_anterior = null;

const Acentos = ["á", "é", "í", "ó", "ú", "ü", "¿"];

const Lista = [
    "Hola",
    "Qué hora es?",
    "Quiero agua",
    "Quiero comer",
    "Quiero ir al lavabo",
    "Quiero dormir",
    "Tengo calor",
    "Tengo frío",
    "No me gusta",
    "Adiós"
];

// Funciones de utilidad
function capitalize(s) {
    if (s.length > 1) {
        return s.substr(0, 1).toUpperCase() + s.substring(1);
    } else {
        return s.toUpperCase();
    }
}

function trim(str) {
    return str.replace(/^\s+|\s+$/g, "");
}

// Ajustar tamaño de texto según longitud
function ajustarTexto() {
    const container = document.getElementById("L1");
    const textLength = textoCompleto.length;
    
    let fontSize;
    if (textLength < 20) {
        fontSize = 5;
    } else if (textLength < 40) {
        fontSize = 4;
    } else if (textLength < 60) {
        fontSize = 3;
    } else if (textLength < 100) {
        fontSize = 2.5;
    } else {
        fontSize = 2;
    }
    
    container.style.fontSize = fontSize + 'em';
}

// Text-to-Speech con Web Speech API
function textToSpeech() {
    if ('speechSynthesis' in window && textoCompleto.trim() !== '') {
        // Cancelar cualquier síntesis en curso
        window.speechSynthesis.cancel();
        
        const utterance = new SpeechSynthesisUtterance(textoCompleto);
        utterance.lang = 'es-ES';
        utterance.rate = 0.6;
        utterance.pitch = 1;
        utterance.volume = 1;
        
        window.speechSynthesis.speak(utterance);
    } else if (!('speechSynthesis' in window)) {
        alert('Tu navegador no soporta síntesis de voz');
    }
}

// Efectos visuales
function fader(elem_id) {
    if (elem_anterior) {
        restore(elem_anterior);
    }
    elem_anterior = elem_id;
    const x = document.getElementById(elem_id);
    if (x) {
        x.classList.add('activo');
        setTimeout(() => restore(elem_id), 300);
    }
}

function restore(elem_id) {
    const x = document.getElementById(elem_id);
    if (x) {
        x.classList.remove('activo');
    }
}

// Funciones de escritura
function pulsaLetra(evt) {
    fader(this.id);
    const txt = document.getElementById("L1");
    const nuevo = this.innerHTML;
    
    if (nuevo === 'Sí' || nuevo === 'No') {
        textoCompleto = nuevo;
    } else {
        textoCompleto += nuevo;
    }
    
    txt.innerHTML = capitalize(textoCompleto);
    ajustarTexto();

    if (Acentos.indexOf(nuevo) >= 0) {
        mostrarNumeros();
    }
}

function pulsaEspacio() {
    fader(this.id);   
    const txt = document.getElementById("L1");
    textoCompleto += ' ';
    txt.innerHTML = capitalize(textoCompleto);
    ajustarTexto();
}

function pulsaComa() {
    fader(this.id);
    const txt = document.getElementById("L1");
    textoCompleto += ',' + (numeros === 0 ? ' ' : '');
    txt.innerHTML = capitalize(textoCompleto);
    ajustarTexto();
}

// Alternar números y acentos
function mostrarNumeros() {
    const cambios = [
        {id: 'L2111', texto: ['b', '1'], colores: ['#BBF', '#FFF']},
        {id: 'L2112', texto: ['c', '2'], colores: ['#BFB', '#DDD']},
        {id: 'L2113', texto: ['ch', '3'], colores: ['#BBF', '#FFF']},
        {id: 'L2121', texto: ['f', '4'], colores: ['#BFB', '#DDD']},
        {id: 'L2122', texto: ['g', '5'], colores: ['#BBF', '#FFF']},
        {id: 'L2123', texto: ['h', '6'], colores: ['#BFB', '#DDD']},
        {id: 'L2131', texto: ['k', '7'], colores: ['#BBF', '#FFF']},
        {id: 'L2132', texto: ['l', '8'], colores: ['#BFB', '#DDD']},
        {id: 'L2133', texto: ['ll', '9'], colores: ['#BBF', '#FFF']},
        {id: 'L2134', texto: ['m', '0'], colores: ['#BFB', '#F88']},
        {id: 'L32', texto: ['a', 'á'], colores: null},
        {id: 'L33', texto: ['e', 'é'], colores: null},
        {id: 'L34', texto: ['i', 'í'], colores: null},
        {id: 'L35', texto: ['o', 'ó'], colores: null},
        {id: 'L36', texto: ['u', 'ú'], colores: null},
        {id: 'L2332', texto: ['x', 'ü'], colores: ['#BFB', '#FF8']},
        {id: 'L222', texto: ['?', '¿'], colores: null}
    ];

    cambios.forEach(cambio => {
        const elem = document.getElementById(cambio.id);
        const esLetra = elem.innerHTML === cambio.texto[0];
        elem.innerHTML = esLetra ? cambio.texto[1] : cambio.texto[0];
        
        if (cambio.colores) {
            elem.style.backgroundColor = esLetra ? cambio.colores[1] : cambio.colores[0];
        }
    });

    numeros = numeros === 0 ? 1 : 0;
}

// Funciones de borrado
function borrarLetra() {
    const txt = document.getElementById("L1");
    textoCompleto = trim(textoCompleto);
    const L = textoCompleto.length;
    textoCompleto = textoCompleto.substr(0, L - 1);
    txt.innerHTML = capitalize(textoCompleto);
    ajustarTexto();
}

function borrarPalabra() {
    const txt = document.getElementById("L1");
    textoCompleto = trim(textoCompleto);
    let idx = textoCompleto.lastIndexOf(" ");
    
    if (idx > -1) {
        textoCompleto = textoCompleto.substring(0, idx);
    } else {
        idx = textoCompleto.lastIndexOf(",");
        if (idx > -1) {
            textoCompleto = textoCompleto.substring(0, idx);
        } else {
            textoCompleto = '';
        }
    }
    txt.innerHTML = capitalize(textoCompleto);
    ajustarTexto();
}

function borrarTodo() {
    textoCompleto = "";
    const txt = document.getElementById("L1");
    txt.innerHTML = textoCompleto;
    ajustarTexto();
}

// Funciones de lista
function lista0() {
    ListaIndex = 0;
    textoCompleto = Lista[ListaIndex];
    document.getElementById("L1").innerHTML = Lista[ListaIndex];
    ajustarTexto();
}

function listaMenos() {
    const n = Lista.length;
    if (ListaIndex > 0) {
        ListaIndex--;
    } else {
        ListaIndex = n - 1;
    }
    textoCompleto = Lista[ListaIndex];
    document.getElementById("L1").innerHTML = Lista[ListaIndex];
    ajustarTexto();
}

function listaMas() {
    const n = Lista.length;
    if (ListaIndex < n - 1) {
        ListaIndex++;
    } else {
        ListaIndex = 0;
    }
    textoCompleto = Lista[ListaIndex];
    document.getElementById("L1").innerHTML = Lista[ListaIndex];
    ajustarTexto();
}

// Asignar eventos
function asignaEventos() {
    // Letras consonantes
    const letras = [
        'L2111', 'L2112', 'L2113', 'L2114',
        'L2121', 'L2122', 'L2123', 'L2124',
        'L2131', 'L2132', 'L2133', 'L2134',
        'L2311', 'L2312', 'L2313', 'L2314',
        'L2321', 'L2322', 'L2323', 'L2324',
        'L2331', 'L2332', 'L2333', 'L2334'
    ];
    
    letras.forEach(id => {
        document.getElementById(id).addEventListener('click', pulsaLetra);
    });

    // Espacio y signos
    document.getElementById('L221').addEventListener('click', pulsaEspacio);
    document.getElementById('L222').addEventListener('click', pulsaLetra);
    document.getElementById('L223').addEventListener('click', pulsaComa);

    // Vocales y Sí/No
    ['L31', 'L32', 'L33', 'L34', 'L35', 'L36', 'L37'].forEach(id => {
        document.getElementById(id).addEventListener('click', pulsaLetra);
    });

    // Números/Acentos
    document.getElementById('L41').addEventListener('click', mostrarNumeros);

    // Borrar
    document.getElementById('L4221').addEventListener('click', borrarLetra);
    document.getElementById('L4222').addEventListener('click', borrarPalabra);
    document.getElementById('L4223').addEventListener('click', borrarTodo);

    // Listas
    document.getElementById('L431').addEventListener('click', lista0);
    document.getElementById('L4321').addEventListener('click', listaMenos);
    document.getElementById('L4322').addEventListener('click', listaMas);

    // Text-to-Speech
    document.getElementById('L1').addEventListener('click', textToSpeech);
}

// Formateo adaptativo (opcional - ya no es tan necesario con flexbox)
function formateaPagina() {
    let W = window.innerWidth;
    let H = window.innerHeight;
    
    const factorEscala = (Math.min(W / 1440, H / 870) + Math.max(W / 1440, H / 870)) / 2;
    
    document.getElementById("L1").style.fontSize = 6 * factorEscala + 'em';
    document.getElementById("L2").style.fontSize = 6 * factorEscala + 'em';
    document.getElementById("L221").style.fontSize = 0.3 * factorEscala + 'em';
    document.getElementById("L3").style.fontSize = 6 * factorEscala + 'em';
    document.getElementById("L4").style.fontSize = 3 * factorEscala + 'em';
    document.getElementById("L421").style.fontSize = 0.5 * factorEscala + 'em';
    document.getElementById("L431").style.fontSize = 0.5 * factorEscala + 'em';
}

// Inicialización
function inicializar() {
    formateaPagina();
    asignaEventos();
}

// Event listeners
window.addEventListener('load', inicializar);
window.addEventListener('resize', formateaPagina);
</script>
</body>
</html>
